<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movimientos - Wallet Chile</title>
    <meta name="author" content="Miguel Gonzalez Roblero">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css.css">
</head>
<body>

    <div class="chile-header">
        <h4 class="m-0">Últimos Movimientos</h4>
    </div>

    <div class="container mt-4">
        
        <div class="mb-4">
            <label for="filter-type" class="form-label">Filtrar por tipo:</label>
            <select id="filter-type" class="form-select">
                <option value="all">Todos</option>
                <option value="deposit">Depósitos</option>
                <option value="withdrawal">Compras / Retiros</option>
                <option value="transfer">Transferencias Recibidas</option>
            </select>
        </div>

        <div id="transactions-list">
        </div>

        <div class="mt-3">
            <a href="menu.html" class="btn btn-link text-secondary">Volver al menú</a>
        </div>
        <div class="text-end mt-3 mb-4 text-muted">
            <small>Desarrollado por Miguel Gonzalez Roblero</small>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            const datosIniciales = [
                { id: 1, type: 'deposit', amount: 50000, date: '2023-10-25', desc: 'Depósito en efectivo' },
                { id: 2, type: 'withdrawal', amount: 12990, date: '2023-10-24', desc: 'Compra Netflix' },
                { id: 3, type: 'transfer', amount: 25000, date: '2023-10-23', desc: 'Transferencia de Juan' },
                { id: 4, type: 'withdrawal', amount: 4500, date: '2023-10-22', desc: 'Uber Eats' },
                { id: 5, type: 'deposit', amount: 100000, date: '2023-10-20', desc: 'Sueldo' }
            ];

            const transaccionesReales = JSON.parse(localStorage.getItem('walletTransactions')) || [];
            const listaTransacciones = [...transaccionesReales, ...datosIniciales];

            function getTipoTransaccion(tipo) {
                switch(tipo) {
                    case 'deposit': return 'Depósito';
                    case 'withdrawal': return 'Compra/Retiro';
                    case 'transfer': return 'Transferencia';
                    default: return 'Movimiento';
                }
            }

            function mostrarUltimosMovimientos(filtro) {
                const container = $('#transactions-list');
                container.empty();

                const filtrados = listaTransacciones.filter(t => filtro === 'all' || t.type === filtro);

                if (filtrados.length === 0) {
                    container.html('<div class="alert alert-info">No hay movimientos para este filtro.</div>');
                    return;
                }

                filtrados.forEach(t => {
                    let cssClass = 'transaction-item';
                    if (t.type === 'deposit' || t.type === 'transfer') {
                        cssClass += ' transaction-deposit';
                    } else {
                        cssClass += ' transaction-withdrawal';
                    }

                    const html = `
                        <div class="${cssClass} shadow-sm">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="mb-1">${t.desc}</h6>
                                    <small class="text-muted">${getTipoTransaccion(t.type)} - ${t.date}</small>
                                </div>
                                <div class="fw-bold ${t.type === 'withdrawal' ? 'text-danger-custom' : 'text-success-custom'}">
                                    ${t.type === 'withdrawal' ? '-' : '+'}$${t.amount.toLocaleString('es-CL')}
                                </div>
                            </div>
                        </div>
                    `;
                    container.append(html);
                });
            }

            mostrarUltimosMovimientos('all');

            $('#filter-type').change(function() {
                const seleccion = $(this).val();
                mostrarUltimosMovimientos(seleccion);
            });
        });
    </script>
</body>
</html>